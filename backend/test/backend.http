@base_url = http://localhost:3000
# @base_url = https://photosphere-api.codecapers.com.au
@token = not needed
@collection = test-collection
@asset = 1234
@hash = ABCD

###

GET {{base_url}}/alive

###
# @name user_metadata
#
# Gets metadata for a user.
#
GET {{base_url}}/user
Authorization: Bearer {{token}}


###
# @name upload_asset
#
# Uploads the metadata for the asset.
#

POST {{base_url}}/operations
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "clientId": "a-client-id",
    "ops": [
        {
            "databaseName": "{{collection}}",
            "collectionName": "metadata",
            "recordId": "{{asset}}",
            "op": {
                "type": "set",
                "fields": {
                    "contentType": "image/jpeg", 
                    "fileName": "./test-assets/1.jpeg", 
                    "width": 4160, 
                    "height": 6240, 
                    "hash": "{{hash}}", 
                    "fileDate": "2023-02-08T01:27:01.419Z", 
                    "photoDate": "2023-02-08T01:27:01.419Z", 
                    "location": "Somewhere1", 
                    "properties": { 
                        "a": "property" 
                    }, 
                    "labels": [ 
                        "Cool photo" 
                    ] 
                }
            }
        },
        {
            "databaseName": "{{collection}}",
            "collectionName": "hashes",
            "recordId": "{{hash}}",
            "op": {
                "type": "push",
                "field": "assetIds",
                "value": "{{asset}}"
            }
        }
    ]
}

###
# Gets metadata for an asset.
#

GET {{base_url}}/get-one?id={{asset}}&db={{collection}}&col=metadata
Authorization: Bearer {{token}}


###
# Gets hashes for an asset.


GET {{base_url}}/get-one?id={{hash}}&db={{collection}}&col=hashes
Authorization: Bearer {{token}}


###
# 
# Uploads the full content for the asset.
#

POST {{base_url}}/asset
Content-Type: image/jpeg
id: {{asset}}
col: {{collection}}
asset-type: original
Authorization: Bearer {{token}}

< ./test-assets/1.jpeg


###
# Retrieve an asset.
#

GET {{base_url}}/asset?id={{asset}}&col={{collection}}&tok={{token}}&type=original

###
#
# Uploads a thumbnail for the asset.
#

POST {{base_url}}/asset
Content-Type: image/jpeg
id: {{asset}}
col: {{collection}}
asset-type: thumb
Authorization: Bearer {{token}}

< ./test-assets/2.jpeg

###
# Retrieve an thumbnail.
#

GET {{base_url}}/asset?id={{asset}}&col={{collection}}&tok={{token}}&type=thumb

###
#
# Uploads the display version of an asset.
#

POST {{base_url}}/asset
Content-Type: image/jpeg
id: {{asset}}
col: {{collection}}
asset-type: display
Authorization: Bearer {{token}}

< ./test-assets/3.jpeg

###
# Retrieve the display asset.
#

GET {{base_url}}/asset?id={{asset}}&col={{collection}}&tok={{token}}&type=display

###
# Gets metadata for an asset.
#

GET {{base_url}}/get-one?id={{asset}}&db={{collection}}&col=metadata
Authorization: Bearer {{token}}

### 
# Sets fields for an asset.
#

POST {{base_url}}/operations
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "clientId": "a-client-id",
    "ops": [{
        "databaseName": "{{collection}}",
        "collectionName": "metadata",
        "recordId": "{{asset}}",
        "op": {
            "type": "set",
            "fields": {
                "aField": "aValue"
            }
        }
    }]
}

###
# Gets metadata for an asset.
#

GET {{base_url}}/get-one?id={{asset}}&db={{collection}}&col=metadata
Authorization: Bearer {{token}}

### 
# Pushes a value on an array.
#

POST {{base_url}}/operations
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "clientId": "a-client-id",
    "ops": [{
        "databaseName": "{{collection}}",
        "collectionName": "metadata",
        "recordId": "{{asset}}",
        "op": {
            "type": "push",
            "field": "anArray",
            "value": "anElementValue"
       }
    }]
}

###
# Gets metadata for an asset.
#

GET {{base_url}}/get-one?id={{asset}}&db={{collection}}&col=metadata
Authorization: Bearer {{token}}

### 
# Pops a value on an array.
#

POST {{base_url}}/operations
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "clientId": "a-client-id",
    "ops": [{
        "databaseName": "{{collection}}",
        "collectionName": "metadata",
        "recordId": "{{asset}}",
        "op": {
            "type": "pull",
            "field": "anArray",
            "value": "anElementValue"
       }
    }]
}

###
# Gets metadata for an asset.
#

GET {{base_url}}/get-one?id={{asset}}&db={{collection}}&col=metadata
Authorization: Bearer {{token}}

###
# Gets journal operations for a collection.
#

POST {{base_url}}/journal
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "collectionId": "{{collection}}",
    "clientId": "a-client-id"
}

###
# Gets journal operations after a certain update.
#

@last_update = 16

POST {{base_url}}/journal
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "collectionId": "{{collection}}",
    "clientId": "a-client-id",
    "lastUpdateId": "{{last_update}}"
}

###
# Lists a page of assets.
#

GET {{base_url}}/list-all?db={{collection}}&col=metadata&max=5
Authorization: Bearer {{token}}

###
# Gets a page of assets.
#

GET {{base_url}}/get-all?db={{collection}}&col=metadata&max=5
Authorization: Bearer {{token}}